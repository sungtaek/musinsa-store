import{l as P,a as u,j as e,C as O}from"./index-va5UnrO5.js";import{b as H,e as C,d as T}from"./cil-monitor-Ecr67Ieb.js";import{C as f,a as j}from"./CRow-CEbGi0CQ.js";import{C as I,a as G}from"./CCardBody-DbCALLaK.js";import{C as A}from"./CCardHeader-DmksiN5A.js";import{C as b}from"./CButton-DDicmkuX.js";import{C as U,a as q,b as B,c as k,d as J,e as y}from"./CTable-DSEzf_iF.js";import{C as V,a as M}from"./CPaginationItem-BcZsXqaI.js";import{C as _}from"./CAlert-STpO8U16.js";import{c as K}from"./cil-burn-DKRRBsQY.js";import{C as Q,a as W,b as S,c as X,d as Y}from"./CModalTitle-BwWOxl_L.js";import{C as Z}from"./CForm-ChVYDIkQ.js";import"./DefaultLayout-pZoWm_zp.js";import"./CConditionalPortal-B6U6fauM.js";const ee=10,v=5,ae=(r,i)=>{const n=r>1?r-1:null,N=r<i?r+1:null,p=Math.floor(v/2);let t=Math.max(r-p,1),m=Math.min(t+v-1,i);m-t+1<v&&t>1&&(t=Math.max(m-v+1,1));const o=Array.from({length:m-t+1},(w,c)=>t+c);return{prevPage:n,curPage:r,nextPage:N,pagination:o}},se=r=>{if(r!=null&&r.data)return{brands:r.data,size:r.size,totalPage:r.totalPage,...ae(r.page+1,r.totalPage)}},re=r=>{if(r!=null&&r.data)return{id:r.data.id,name:r.data.name,categories:r.data.products.reduce((i,n)=>(i[n.category]=n,i),{})}},z=r=>({name:"",categories:Object.keys(r).reduce((i,n)=>(i[n]={category:n,price:0},i),{})}),pe=()=>{const r=P(a=>a.backendUrl),i=P(a=>a.categories),[n,N]=u.useState(null),[p,t]=u.useState(!1),[m,o]=u.useState(null),[w,c]=u.useState(!1),[d,g]=u.useState(z(i)),x=a=>{t(!0),o(null),fetch(r+"/api/v1/brands?page="+a+"&size="+ee,{method:"GET",headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}).then(s=>s.ok?s.json():s.json().then(l=>{const h=`Network error: ${s.status} - ${l.message}`;throw new Error(h)})).then(s=>{N(se(s)),t(!1)}).catch(s=>{o(s),t(!1)})},E=a=>{a?(t(!0),o(null),fetch(r+"/api/v1/brands/"+a,{method:"GET",headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}).then(s=>s.ok?s.json():s.json().then(l=>{const h=`Network error: ${s.status} - ${l.message}`;throw new Error(h)})).then(s=>{g(re(s)),t(!1),c(!0)}).catch(s=>{o(s),t(!1)})):(g(z(i)),c(!0))},$=a=>{g({...d,name:a})},D=(a,s)=>{d.categories[a].price=Number(s),g({...d,categories:d.categories})},R=a=>{t(!0),o(null);const s=a.id===void 0?"/api/v1/brands":"/api/v1/brands/"+a.id;fetch(r+s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,name:a.name,products:Object.values(a.categories)})}).then(l=>{if(!l.ok)return l.json().then(h=>{const F=`Network error: ${l.status} - ${h.message}`;throw new Error(F)});t(!1),c(!1),x(0)}).catch(l=>{o(l),t(!1),c(!1)})},L=a=>{t(!0),o(null),fetch(r+"/api/v1/brands/"+a,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(s=>{if(!s.ok)return s.json().then(l=>{const h=`Network error: ${s.status} - ${l.message}`;throw new Error(h)});t(!1),c(!1),x(0)}).catch(s=>{o(s),t(!1),c(!1)})};return u.useEffect(()=>{x(0)},[]),e.jsx(f,{children:e.jsx(j,{xs:12,children:e.jsxs(I,{className:"mb-4",children:[e.jsx(A,{children:e.jsx("strong",{children:"브랜드 및 상품 관리"})}),e.jsxs(G,{children:[e.jsx(f,{className:"justify-content-end",children:e.jsx(j,{xs:"auto",className:"text-end",children:e.jsx(b,{type:"button",color:"primary",variant:"outline",size:"sm",onClick:()=>E(),children:"추가"})})}),e.jsxs(U,{hover:!0,children:[e.jsx(q,{children:e.jsxs(B,{children:[e.jsx(k,{scope:"col",children:"ID"}),e.jsx(k,{scope:"col",children:"브랜드"}),e.jsx(k,{scope:"col"})]})}),e.jsx(J,{children:n&&n.brands.map((a,s)=>e.jsxs(B,{children:[e.jsx(y,{children:a.id}),e.jsx(y,{children:e.jsx("a",{href:"#",style:{textDecoration:"none"},onClick:l=>{l.preventDefault(),E(a.id)},children:a.name})}),e.jsx(y,{className:"text-end",children:e.jsx(b,{type:"button",color:"danger",variant:"outline",size:"sm",onClick:()=>L(a.id),children:"삭제"})})]},s))})]}),n&&e.jsxs(V,{"aria-label":"Page navigation",align:"center",size:"sm",children:[e.jsx(M,{"aria-label":"Previous",disabled:n.prevPage==null,href:"#",onClick:a=>{a.preventDefault(),x(n.prevPage-1)},children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),n.pagination.map(a=>e.jsx(M,{active:a===n.curPage,href:"#",onClick:s=>{s.preventDefault(),x(a-1)},children:a})),e.jsx(M,{"aria-label":"Next",disabled:n.nextPage==null,href:"#",onClick:a=>{a.preventDefault(),x(n.nextPage-1)},children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]}),m&&e.jsxs(_,{color:"danger",className:"d-flex align-items-center",children:[e.jsx(H,{icon:K,className:"flex-shrink-0 me-2",width:24,height:24}),e.jsx("div",{children:m.message})]})]}),e.jsx(Q,{alignment:"center",backdrop:"static",size:"lg",visible:w,onClose:()=>c(!1),"aria-labelledby":"editModal",children:e.jsxs(Z,{onSubmit:()=>R(d),children:[e.jsxs(W,{children:[!d.id&&e.jsx(S,{id:"editModal",children:"브랜드 및 상품 추가"}),d.id&&e.jsx(S,{id:"editModal",children:"브랜드 및 상품 수정"})]}),e.jsxs(X,{children:[e.jsxs(f,{className:"mb-3",children:[e.jsx(C,{className:"col-sm-3 col-form-label",children:e.jsx("b",{children:"브랜드명"})}),e.jsx(j,{sm:5,children:e.jsx(T,{id:"name",value:d.name,required:!0,onChange:a=>$(a.target.value)})})]}),e.jsxs(f,{className:"mb-3",children:[e.jsx(C,{className:"col-sm-3 col-form-label",children:e.jsx("b",{children:"상품"})}),e.jsxs(j,{sm:9,children:[e.jsxs(f,{className:"mb-3",children:[e.jsx(C,{className:"col-sm-3 col-form-label",children:e.jsx("h6",{children:"카테고리"})}),e.jsx(C,{className:"col-sm-7 col-form-label",children:e.jsx("h6",{children:"가격"})})]}),Object.keys(i).map((a,s)=>{var l;return e.jsxs(f,{className:"mb-3",children:[e.jsx(C,{className:"col-sm-3 col-form-label",children:i[a]}),e.jsx(j,{sm:7,children:e.jsx(T,{type:"number",min:"0",id:a,value:(l=d.categories[a])==null?void 0:l.price,onChange:h=>D(a,h.target.value)})})]})})]})]})]}),e.jsxs(Y,{children:[e.jsx(b,{color:"secondary",variant:"outline",onClick:()=>c(!1),children:"취소"}),e.jsxs(b,{type:"submit",color:"primary",variant:"outline",children:[p&&e.jsx(O,{as:"span",size:"sm","aria-hidden":"true"}),!p&&e.jsx(e.Fragment,{children:"저장"})]})]})]})})]})})})};export{pe as default};
